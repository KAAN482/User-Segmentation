<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Segmentation Rule Tester</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      padding: 20px;
      background-color: #f4f4f9;
      color: #333;
      display: flex;
      flex-direction: column;
      height: 95vh;
    }

    h1 {
      text-align: center;
      margin-bottom: 20px;
      color: #444;
    }

    .container {
      display: flex;
      flex: 1;
      gap: 20px;
    }

    .pane {
      flex: 1;
      display: flex;
      flex-direction: column;
      background: #fff;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }

    .pane h2 {
      margin-top: 0;
      font-size: 1.2rem;
      color: #555;
      border-bottom: 2px solid #eee;
      padding-bottom: 10px;
      margin-bottom: 15px;
    }

    textarea {
      flex: 1;
      width: 100%;
      font-family: 'Consolas', 'Monaco', monospace;
      font-size: 14px;
      border: 1px solid #ccc;
      border-radius: 4px;
      padding: 10px;
      resize: none;
      box-sizing: border-box;
      background-color: #fafafa;
    }

    button {
      margin-top: 15px;
      padding: 12px;
      background-color: #007bff;
      color: white;
      border: none;
      border-radius: 4px;
      font-size: 16px;
      cursor: pointer;
      transition: background-color 0.2s;
      align-self: center;
      width: 50%;
    }

    button:hover {
      background-color: #0056b3;
    }

    pre {
      flex: 1;
      background-color: #2d2d2d;
      color: #f8f8f2;
      padding: 15px;
      border-radius: 4px;
      overflow: auto;
      margin: 0;
      font-family: 'Consolas', 'Monaco', monospace;
    }

    .error {
      color: #ff6b6b;
    }
  </style>
</head>

<body>

  <h1>Segmentation Rule Evaluator</h1>

  <div class="container">
    <!-- Left Pane: Input -->
    <div class="pane">
      <h2>Input JSON (User & Segments)</h2>
      <textarea id="jsonInput">{
    "user": {
        "id": 101,
        "level": 25,
        "country": "Turkey",
        "last_login_days_ago": 2,
        "purchase_amount": 5000
    },
    "segments": {
        "is_vip": "level > 20",
        "is_turkey": "country = 'Turkey'",
        "high_spender": "purchase_amount >= 10000",
        "active_user": "last_login_days_ago < 7"
    }
}</textarea>
      <button onclick="evaluateRules()">Test Et</button>
    </div>

    <!-- Right Pane: Output -->
    <div class="pane">
      <h2>Result</h2>
      <pre id="resultOutput">// Results will appear here...</pre>
    </div>
  </div>

  <script>
    async function evaluateRules() {
      const inputArea = document.getElementById('jsonInput');
      const outputArea = document.getElementById('resultOutput');
      const rawInput = inputArea.value;

      // 1. Validate JSON syntax locally
      let requestData;
      try {
        requestData = JSON.parse(rawInput);
      } catch (e) {
        outputArea.innerHTML = `<span class="error">Invalid JSON syntax: ${e.message}</span>`;
        return;
      }

      outputArea.textContent = "Processing...";

      // 2. Send POST request
      try {
        const response = await fetch('/evaluate', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(requestData)
        });

        const data = await response.json();

        // Format JSON output
        outputArea.textContent = JSON.stringify(data, null, 4);

        if (!response.ok) {
          outputArea.classList.add('error');
        } else {
          outputArea.classList.remove('error');
        }

      } catch (err) {
        outputArea.innerHTML = `<span class="error">Network/Server Error: ${err.message}</span>`;
      }
    }
  </script>
</body>

</html>